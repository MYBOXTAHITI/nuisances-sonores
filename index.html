<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enqu√™te Nuisances Sonores - Presqu'√Æle de Tahiti</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .header h1 {
            color: #333;
            font-size: 2.2em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .intro {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .question-block {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            transition: transform 0.3s ease;
        }
        
        .question-block:hover {
            transform: translateX(5px);
        }
        
        .question-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .checkbox-group, .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .checkbox-item:hover, .radio-item:hover {
            background: #e3f2fd;
            transform: translateX(3px);
        }
        
        input[type="checkbox"], input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: block;
            margin: 30px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
        }
        
        .results {
            display: none;
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border: 2px solid #4caf50;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        
        .chart-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 25px;
            margin: 8px 0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            color: white;
            font-weight: bold;
            padding: 0 15px;
            transition: width 0.5s ease;
            font-size: 14px;
        }
        
        .analysis-text {
            background: #f8f9fa;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .analysis-text p {
            margin: 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .chart-data {
            background: #f1f3f4;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .chart-data-item {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 3px;
            border-left: 3px solid #667eea;
        }
        
        .facebook-post {
            background: #1877f2;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        
        .facebook-post .post-header {
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Enqu√™te Nuisances Sonores</h1>
            <p style="color: #666; font-size: 1.1em;">Commune de Taiarapu-Est - Action Citoyenne</p>
            <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin-top: 15px;">
                <strong>Temps estim√© : 3-4 minutes</strong>
                <div class="footer">
            <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                <button id="adminBtn" onclick="showAdminPanel()" style="background: #ff6b35; color: white; padding: 10px 20px; border: none; border-radius: 25px; cursor: pointer; font-size: 0.9em;">
                    üîê Administration
                </button>
            </div>
            
            <div id="adminPanel" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 2px solid #ff6b35;">
                <h4 style="color: #ff6b35; text-align: center;">Panel Administrateur</h4>
                <div style="text-align: center;">
                    <input type="password" id="adminPassword" placeholder="Mot de passe" style="padding: 10px; margin: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                    <br>
                    <button onclick="generateTable()" style="background: #4caf50; color: white; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; margin: 10px;">
                        üìä G√©n√©rer Tableau des Insatisfaits
                    </button>
                </div>
            </div>
            
            <div id="resultTable" style="display: none; margin-top: 30px;"></div>
        </div>
    </div>
        </div>
        
        <div class="facebook-post">
            <div class="post-header">APPEL √Ä T√âMOIGNAGES - COMMUNE DE TAIARAPU-EST</div>
            <p>Habitants de Taiarapu-Est ! Les nuisances sonores (motos, musique forte, rassemblements nocturnes) perturbent notre tranquillit√© et notre sant√©.</p>
            <p>Ensemble, documentons ces probl√®mes pour une action collective constructive !</p>
        </div>
        
        <form id="noiseForm">
            <div class="question-block">
                <div class="question-title">1. Quels types de nuisances sonores constatez-vous ? (Plusieurs r√©ponses possibles)</div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="motos" name="nuisances" value="motos">
                        <label for="motos">Motos bruyantes ou rod√©os urbains</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="musique" name="nuisances" value="musique">
                        <label for="musique">Musique trop forte (hauts-parleurs, soir√©es)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="rassemblements" name="nuisances" value="rassemblements">
                        <label for="rassemblements">Rassemblements nocturnes bruyants</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="autres" name="nuisances" value="autres">
                        <label for="autres">Autres bruits g√™nants</label>
                    </div>
                </div>
                <input type="text" id="autresDetails" placeholder="Pr√©cisez les autres nuisances..." style="margin-top: 10px;">
            </div>
            
            <div class="question-block">
                <div class="question-title">2. √Ä quelle fr√©quence subissez-vous ces nuisances ?</div>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="quotidien" name="frequence" value="quotidien">
                        <label for="quotidien">Tous les jours</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="plusieurs" name="frequence" value="plusieurs">
                        <label for="plusieurs">Plusieurs fois par semaine</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="hebdo" name="frequence" value="hebdo">
                        <label for="hebdo">Une fois par semaine</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="mensuel" name="frequence" value="mensuel">
                        <label for="mensuel">Quelques fois par mois</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="rare" name="frequence" value="rare">
                        <label for="rare">Tr√®s rarement</label>
                    </div>
                </div>
            </div>
            
            <div class="question-block">
                <div class="question-title">3. √Ä quels moments ces bruits sont-ils les plus d√©rangeants ?</div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="jour" name="moments" value="jour">
                        <label for="jour">Journ√©e (7h-18h)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="soiree" name="moments" value="soiree">
                        <label for="soiree">Soir√©e (18h-22h)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="nuit" name="moments" value="nuit">
                        <label for="nuit">Nuit (22h-5h)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="matin" name="moments" value="matin">
                        <label for="matin">Petit matin (5h-7h)</label>
                    </div>
                </div>
            </div>
            
            <div class="question-block">
                <div class="question-title">4. O√π se produisent ces nuisances ?</div>
                <label for="commune" style="display: block; margin-bottom: 10px; font-weight: bold;">Commune associ√©e :</label>
                <select id="commune" name="commune" required style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 16px; margin-bottom: 15px;">
                    <option value="">S√©lectionnez votre commune</option>
                    <option value="afaahiti-taravao">Afaahiti-Taravao</option>
                    <option value="faaone">Faaone</option>
                    <option value="pueu">Pueu</option>
                    <option value="tautira">Tautira</option>
                </select>
                <label for="lieu" style="display: block; margin-bottom: 10px; font-weight: bold;">Lieu pr√©cis :</label>
                <input type="text" id="lieu" name="lieu" placeholder="Ex: Quartier, rue, pr√®s de la plage..." required>
            </div>
            
            <div class="question-block">
                <div class="question-title">5. Quels impacts sur votre sant√© et qualit√© de vie ?</div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="sommeil" name="impacts" value="sommeil">
                        <label for="sommeil">Troubles du sommeil / insomnies</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stress" name="impacts" value="stress">
                        <label for="stress">Stress, irritabilit√©, fatigue</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="enfants" name="impacts" value="enfants">
                        <label for="enfants">Effets sur les enfants</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="aines" name="impacts" value="aines">
                        <label for="aines">Effets sur les personnes √¢g√©es</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="insecurite" name="impacts" value="insecurite">
                        <label for="insecurite">Sentiment d'ins√©curit√©</label>
                    </div>
                </div>
            </div>
            
            <div class="question-block">
                <div class="question-title">6. Avez-vous d√©j√† fait des d√©marches ?</div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="police" name="demarches" value="police">
                        <label for="police">Signalement aux forces de l'ordre</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="mairie" name="demarches" value="mairie">
                        <label for="mairie">Contact avec la mairie</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="dialogue" name="demarches" value="dialogue">
                        <label for="dialogue">Dialogue avec les auteurs</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="aucune" name="demarches" value="aucune">
                        <label for="aucune">Aucune d√©marche</label>
                    </div>
                </div>
            </div>
            
            <div class="question-block">
                <div class="question-title">7. Si oui, quelles suites ou r√©ponses avez-vous obtenues suite √† vos d√©marches ?</div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="aucune_suite" name="suites" value="aucune_suite">
                        <label for="aucune_suite">Aucune intervention ni am√©lioration constat√©e (les nuisances continuent)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="ponctuelle" name="suites" value="ponctuelle">
                        <label for="ponctuelle">Une intervention ponctuelle a eu lieu (ex : patrouille de police) mais sans effet durable</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="sans_reponse" name="suites" value="sans_reponse">
                        <label for="sans_reponse">Votre signalement est rest√© sans r√©ponse de la part des autorit√©s</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="pas_competence" name="suites" value="pas_competence">
                        <label for="pas_competence">On vous a r√©pondu que ce probl√®me ne relevait pas de leur comp√©tence</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="amelioration" name="suites" value="amelioration">
                        <label for="amelioration">Des actions ont √©t√© entreprises et la situation s'est am√©lior√©e durablement</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="autre_suite" name="suites" value="autre_suite">
                        <label for="autre_suite">Autre r√©ponse des autorit√©s / autre r√©sultat (pr√©cisez)</label>
                    </div>
                </div>
                <input type="text" id="autresSuitesDetails" placeholder="Pr√©cisez l'autre r√©ponse ou r√©sultat..." style="margin-top: 10px;">
            </div>
            
            <div class="question-block">
                <div class="question-title">8. Depuis combien de temps subissez-vous ces nuisances ?</div>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="moins_1mois" name="duree" value="moins_1mois">
                        <label for="moins_1mois">Moins d'un mois</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="1_3mois" name="duree" value="1_3mois">
                        <label for="1_3mois">1 √† 3 mois</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="3_6mois" name="duree" value="3_6mois">
                        <label for="3_6mois">3 √† 6 mois</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="plus_6mois" name="duree" value="plus_6mois">
                        <label for="plus_6mois">Plus de 6 mois</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="plusieurs_annees" name="duree" value="plusieurs_annees">
                        <label for="plusieurs_annees">Depuis plusieurs ann√©es</label>
                    </div>
                </div>
            </div>
            
            <div class="question-block">
                <div class="question-title">9. Accepteriez-vous de rejoindre un collectif citoyen ou d'√™tre recontact√© si besoin ?</div>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="oui_collectif" name="collectif" value="oui">
                        <label for="oui_collectif">Oui</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="non_collectif" name="collectif" value="non">
                        <label for="non_collectif">Non</label>
                    </div>
                </div>
                <div style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.9em; color: #2e7d32;">
                    <strong>Utilit√© :</strong> permet de constituer un noyau d'action
                </div>
            </div>
            
            <div class="question-block">
                <div class="question-title">10. Informations personnelles</div>
                <input type="text" id="nom" placeholder="Nom" required style="margin-bottom: 10px;">
                <input type="text" id="prenom" placeholder="Pr√©nom" required style="margin-bottom: 10px;">
                <input type="tel" id="telephone" placeholder="Num√©ro de t√©l√©phone" required style="margin-bottom: 10px;">
                <input type="text" id="secteur" placeholder="Secteur de r√©sidence (ex: Taravao, Teahupoo...)" style="margin-bottom: 10px;">
                <input type="text" id="contact" placeholder="Email - facultatif">
            </div>
            
            <button type="submit" class="submit-btn">Valider mon t√©moignage</button>
        </form>
        
        <div id="thanksMessage" style="display: none; background: #4caf50; color: white; padding: 20px; border-radius: 10px; margin-top: 20px; text-align: center;">
            <h3>Merci pour votre participation !</h3>
            <p>Votre t√©moignage a √©t√© enregistr√© et contribue √† notre action collective. Ensemble, nous pouvons faire entendre notre voix pour retrouver la tranquillit√© dans nos quartiers.</p>
            <p><strong>N'h√©sitez pas √† partager cette enqu√™te</strong> aupr√®s d'autres habitants de Taiarapu-Est concern√©s par ces nuisances.</p>
            <p id="contactMessage" style="font-size: 0.9em; margin-top: 15px; display: none; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px;">
                üìû Si vous avez accept√© de rejoindre le collectif, vous pourrez √™tre recontact√©(e) prochainement pour organiser l'action collective.
            </p>
            <p style="font-size: 0.9em; margin-top: 15px;">La tranquillit√© publique est l'affaire de tous. Unis et d√©termin√©s, nous pouvons faire changer les choses !</p>
        </div>
    </div>

    <script>
        // Initialisation compl√®te des variables au d√©but
        let responses = {
            nuisances: { motos: 0, musique: 0, rassemblements: 0, autres: 0 },
            frequence: { quotidien: 0, plusieurs: 0, hebdo: 0, mensuel: 0, rare: 0 },
            moments: { jour: 0, soiree: 0, nuit: 0, matin: 0 },
            impacts: { sommeil: 0, stress: 0, enfants: 0, aines: 0, insecurite: 0 },
            duree: { moins_1mois: 0, '1_3mois': 0, '3_6mois': 0, plus_6mois: 0, plusieurs_annees: 0 },
            suites: { aucune_suite: 0, ponctuelle: 0, sans_reponse: 0, pas_competence: 0, amelioration: 0, autre_suite: 0 },
            collectif: { oui: 0, non: 0 },
            total: 0
        };

        // Stockage des participants uniques et des r√©ponses d√©taill√©es
        let participants = new Set();
        let detailedResponses = [];
        
        console.log('Variables initialis√©es:', { participants: participants.size, detailedResponses: detailedResponses.length });

        document.getElementById('noiseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('=== D√âBUT SOUMISSION ===');
            
            // V√©rifier que nom, pr√©nom et t√©l√©phone sont remplis
            const nom = document.getElementById('nom').value.trim();
            const prenom = document.getElementById('prenom').value.trim();
            const telephoneInput = document.getElementById('telephone').value.trim();
            
            console.log('Nom:', nom, 'Pr√©nom:', prenom, 'T√©l√©phone:', telephoneInput);
            
            if (!nom || !prenom || !telephoneInput) {
                alert('Veuillez remplir votre nom, pr√©nom et num√©ro de t√©l√©phone pour valider votre t√©moignage.');
                return;
            }
            
            // Cr√©er une cl√© unique avec nom + pr√©nom (en minuscules pour √©viter les doublons de casse)
            const participantKey = (nom + '_' + prenom).toLowerCase();
            console.log('Cl√© participant:', participantKey);
            
            // Pour le debug, on va temporairement permettre les doublons
            /*
            if (participants.has(participantKey)) {
                alert('Vous avez d√©j√† particip√© √† cette enqu√™te. Merci pour votre t√©moignage !');
                return;
            }
            */
            
            // Ajouter le participant
            participants.add(participantKey);
            console.log('Participant ajout√©. Total participants:', participants.size);
            
            // Capturer TOUTES les donn√©es du formulaire
            const formData = new FormData(this);
            console.log('FormData cr√©√©');
            
            // Capturer chaque champ individuellement pour debug
            const commune = formData.get('commune');
            const telephoneValue = document.getElementById('telephone').value.trim();
            const contactEmail = document.getElementById('contact').value.trim();
            const nuisances = Array.from(formData.getAll('nuisances'));
            const demarches = Array.from(formData.getAll('demarches'));
            const suites = Array.from(formData.getAll('suites'));
            const collectif = formData.get('collectif');
            
            console.log('Donn√©es captur√©es:');
            console.log('- Commune:', commune);
            console.log('- T√©l√©phone:', telephoneValue);
            console.log('- Email:', contactEmail);
            console.log('- Nuisances:', nuisances);
            console.log('- D√©marches:', demarches);
            console.log('- Suites:', suites);
            console.log('- Collectif:', collectif);
            
            // Cr√©er l'objet de r√©ponse d√©taill√©e
            const detailedResponse = {
                nom: nom,
                prenom: prenom,
                commune: commune,
                telephone: telephoneValue,
                contact: contactEmail,
                nuisances: nuisances,
                demarches: demarches,
                suites: suites,
                collectif: collectif,
                timestamp: new Date().toISOString()
            };
            
            console.log('Objet d√©taill√© cr√©√©:', detailedResponse);
            
            // Ajouter aux r√©ponses d√©taill√©es
            detailedResponses.push(detailedResponse);
            console.log('R√©ponse ajout√©e. Total r√©ponses:', detailedResponses.length);
            
            // Compter cette participation
            responses.total++;
            console.log('Total g√©n√©ral:', responses.total);
            
            // Mise √† jour des donn√©es (simulation)
            const nuisancesSelected = formData.getAll('nuisances');
            const frequenceSelected = formData.get('frequence');
            const momentsSelected = formData.getAll('moments');
            const impactsSelected = formData.getAll('impacts');
            const dureeSelected = formData.get('duree');
            const suitesSelected = formData.getAll('suites');
            const collectifSelected = formData.get('collectif');
            
            // Incr√©menter les compteurs
            nuisancesSelected.forEach(n => {
                if (responses.nuisances[n] !== undefined) responses.nuisances[n]++;
            });
            if (frequenceSelected && responses.frequence[frequenceSelected] !== undefined) {
                responses.frequence[frequenceSelected]++;
            }
            momentsSelected.forEach(m => {
                if (responses.moments[m] !== undefined) responses.moments[m]++;
            });
            impactsSelected.forEach(i => {
                if (responses.impacts[i] !== undefined) responses.impacts[i]++;
            });
            if (dureeSelected && responses.duree[dureeSelected] !== undefined) {
                responses.duree[dureeSelected]++;
            }
            suitesSelected.forEach(s => {
                if (responses.suites[s] !== undefined) responses.suites[s]++;
            });
            if (collectifSelected && responses.collectif[collectifSelected] !== undefined) {
                responses.collectif[collectifSelected]++;
            }
            
            // Message de confirmation
            const collectifChoice = formData.get('collectif');
            if (collectifChoice === 'oui') {
                document.getElementById('contactMessage').style.display = 'block';
            }
            
            console.log('=== FIN SOUMISSION ===');
            console.log('Donn√©es finales stock√©es:', detailedResponses);
            
            document.getElementById('thanksMessage').style.display = 'block';
            document.getElementById('thanksMessage').scrollIntoView({ behavior: 'smooth' });
        });

        function showResults() {
            document.getElementById('results').style.display = 'block';
            document.getElementById('totalResponses').textContent = responses.total;
            
            // Cr√©er les graphiques
            createChart('nuisancesChart', responses.nuisances, {
                motos: 'Motos bruyantes',
                musique: 'Musique forte',
                rassemblements: 'Rassemblements',
                autres: 'Autres'
            });
            
            createChart('frequenceChart', responses.frequence, {
                quotidien: 'Quotidien',
                plusieurs: 'Plusieurs fois/semaine',
                hebdo: 'Hebdomadaire',
                mensuel: 'Mensuel',
                rare: 'Rare'
            });
            
            createChart('momentsChart', responses.moments, {
                jour: 'Journ√©e (7h-18h)',
                soiree: 'Soir√©e (18h-22h)',
                nuit: 'Nuit (22h-5h)',
                matin: 'Matin (5h-7h)'
            });
            
            createChart('impactsChart', responses.impacts, {
                sommeil: 'Troubles du sommeil',
                stress: 'Stress/irritabilit√©',
                enfants: 'Impact sur enfants',
                aines: 'Impact sur a√Æn√©s',
                insecurite: 'Ins√©curit√©'
            });
            
            createChart('dureeChart', responses.duree, {
                moins_1mois: 'Moins d\'un mois',
                '1_3mois': '1 √† 3 mois',
                '3_6mois': '3 √† 6 mois',
                plus_6mois: 'Plus de 6 mois',
                plusieurs_annees: 'Plusieurs ann√©es'
            });
            
            createChart('suitesChart', responses.suites, {
                aucune_suite: 'Aucune am√©lioration',
                ponctuelle: 'Intervention ponctuelle',
                sans_reponse: 'Sans r√©ponse',
                pas_competence: 'Pas de comp√©tence',
                amelioration: 'Am√©lioration durable',
                autre_suite: 'Autre r√©sultat'
            });
            
            createChart('collectifChart', responses.collectif, {
                oui: 'Oui, pr√™t(e) √† rejoindre',
                non: 'Non, pas int√©ress√©(e)'
            });
            
            // G√©n√©rer les analyses
            generateAnalyses();
            
            // Scroll vers les r√©sultats
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function createChart(containerId, data, labels) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            const values = Object.values(data);
            const maxValue = Math.max(...values);
            
            // Cr√©er les barres de donn√©es
            const chartData = document.createElement('div');
            chartData.className = 'chart-data';
            
            Object.entries(data).forEach(([key, value]) => {
                const item = document.createElement('div');
                item.className = 'chart-data-item';
                item.innerHTML = `<strong>${labels[key] || key}:</strong> ${value}`;
                chartData.appendChild(item);
            });
            
            container.appendChild(chartData);
        }
        
        function generateAnalyses() {
            const total = responses.total;
            
            // Analyse nuisances
            const topNuisance = Object.entries(responses.nuisances).reduce((a, b) => responses.nuisances[a[0]] > responses.nuisances[b[0]] ? a : b);
            const nuisanceText = total === 0 ? "Aucune donn√©e collect√©e." : 
                total === 1 ? `Premier t√©moignage collect√©. Nuisance principale : ${topNuisance[0] === 'motos' ? 'motos bruyantes' : topNuisance[0] === 'musique' ? 'musique forte' : topNuisance[0] === 'rassemblements' ? 'rassemblements nocturnes' : 'autres nuisances'}.` :
                `${topNuisance[1]} t√©moignages sur ${total} signalent des ${topNuisance[0] === 'motos' ? 'motos bruyantes' : topNuisance[0] === 'musique' ? 'musique forte' : topNuisance[0] === 'rassemblements' ? 'rassemblements nocturnes' : 'autres nuisances'}.`;
            document.getElementById('nuisancesAnalysis').textContent = nuisanceText;
            
            // Analyse fr√©quence
            const topFrequence = Object.entries(responses.frequence).reduce((a, b) => responses.frequence[a[0]] > responses.frequence[b[0]] ? a : b);
            const frequenceText = total === 0 ? "Aucune donn√©e collect√©e." :
                total === 1 ? `Fr√©quence rapport√©e : ${topFrequence[0] === 'quotidien' ? 'quotidienne' : topFrequence[0] === 'plusieurs' ? 'plusieurs fois par semaine' : topFrequence[0] === 'hebdo' ? 'hebdomadaire' : topFrequence[0] === 'mensuel' ? 'mensuelle' : 'rare'}.` :
                `${topFrequence[1]} t√©moignages sur ${total} rapportent une fr√©quence ${topFrequence[0] === 'quotidien' ? 'quotidienne' : topFrequence[0] === 'plusieurs' ? 'plusieurs fois par semaine' : topFrequence[0] === 'hebdo' ? 'hebdomadaire' : topFrequence[0] === 'mensuel' ? 'mensuelle' : 'rare'}.`;
            document.getElementById('frequenceAnalysis').textContent = frequenceText;
            
            // Analyse moments
            const topMoment = Object.entries(responses.moments).reduce((a, b) => responses.moments[a[0]] > responses.moments[b[0]] ? a : b);
            const momentText = total === 0 ? "Aucune donn√©e collect√©e." :
                `P√©riode la plus d√©rangeante : ${topMoment[0] === 'nuit' ? 'nuit (22h-5h)' : topMoment[0] === 'soiree' ? 'soir√©e (18h-22h)' : topMoment[0] === 'jour' ? 'journ√©e (7h-18h)' : 'matin (5h-7h)'}.`;
            document.getElementById('momentsAnalysis').textContent = momentText;
            
            // Analyse impacts
            const topImpact = Object.entries(responses.impacts).reduce((a, b) => responses.impacts[a[0]] > responses.impacts[b[0]] ? a : b);
            const impactText = total === 0 ? "Aucune donn√©e collect√©e." :
                `Impact principal : ${topImpact[0] === 'sommeil' ? 'troubles du sommeil' : topImpact[0] === 'stress' ? 'stress et irritabilit√©' : topImpact[0] === 'insecurite' ? 'sentiment d\'ins√©curit√©' : topImpact[0] === 'enfants' ? 'effets sur les enfants' : 'effets sur les a√Æn√©s'}.`;
            document.getElementById('impactsAnalysis').textContent = impactText;
            
            // Analyse dur√©e
            const topDuree = Object.entries(responses.duree).reduce((a, b) => responses.duree[a[0]] > responses.duree[b[0]] ? a : b);
            const dureeText = total === 0 ? "Aucune donn√©e collect√©e." :
                `Dur√©e principale : ${topDuree[0] === 'plusieurs_annees' ? 'plusieurs ann√©es' : topDuree[0] === 'plus_6mois' ? 'plus de 6 mois' : topDuree[0] === '3_6mois' ? '3 √† 6 mois' : topDuree[0] === '1_3mois' ? '1 √† 3 mois' : 'moins d\'un mois'}.`;
            document.getElementById('dureeAnalysis').textContent = dureeText;
            
            // Analyse suites
            const topSuite = Object.entries(responses.suites).reduce((a, b) => responses.suites[a[0]] > responses.suites[b[0]] ? a : b);
            const suiteText = total === 0 ? "Aucune donn√©e collect√©e." :
                `R√©ponse institutionnelle : ${topSuite[0] === 'aucune_suite' ? 'aucune am√©lioration constat√©e' : topSuite[0] === 'ponctuelle' ? 'intervention ponctuelle sans effet durable' : topSuite[0] === 'sans_reponse' ? 'signalements rest√©s sans r√©ponse' : topSuite[0] === 'pas_competence' ? 'renvoi de comp√©tence' : topSuite[0] === 'amelioration' ? 'am√©lioration durable' : 'autre r√©sultat'}.`;
            document.getElementById('suitesAnalysis').textContent = suiteText;
            
            // Analyse collectif
            const oui_collectif = responses.collectif.oui || 0;
            const non_collectif = responses.collectif.non || 0;
            const collectifText = total === 0 ? "Aucune donn√©e collect√©e." :
                total === 1 ? `${oui_collectif === 1 ? 'Personne pr√™te √† rejoindre le collectif' : 'Personne non int√©ress√©e par le collectif'}.` :
                `${oui_collectif} personne(s) pr√™te(s) √† rejoindre le collectif sur ${total} t√©moignages (${Math.round((oui_collectif/total)*100)}%).`;
            document.getElementById('collectifAnalysis').textContent = collectifText;
        }

        // Animation d'entr√©e
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser les analyses au chargement
            generateAnalyses();
            
            const questionBlocks = document.querySelectorAll('.question-block');
            questionBlocks.forEach((block, index) => {
                setTimeout(() => {
                    block.style.opacity = '0';
                    block.style.transform = 'translateY(20px)';
                    block.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        block.style.opacity = '1';
                        block.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 100);
            });
        });
        
        // Fonctions administrateur
        function showAdminPanel() {
            const panel = document.getElementById('adminPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        function generateTable() {
            const password = document.getElementById('adminPassword').value;
            
            if (password !== 'taiarapu2024') {
                alert('Mot de passe incorrect');
                return;
            }
            
            console.log('Toutes les r√©ponses stock√©es:', detailedResponses);
            
            // Pour l'instant, afficher TOUTES les r√©ponses qui acceptent le collectif
            const collectifResponses = detailedResponses.filter(response => 
                response.collectif === 'oui'
            );
            
            console.log('R√©ponses avec collectif=oui:', collectifResponses);
            
            // Si aucune r√©ponse avec collectif, afficher toutes les r√©ponses
            let finalResponses = collectifResponses.length > 0 ? collectifResponses : detailedResponses;
            
            // G√©n√©rer le tableau HTML
            let tableHTML = `
                <h3 style="color: #1976d2; text-align: center;">üìã Tableau des R√©sidents</h3>
                <p style="text-align: center; color: #666; margin-bottom: 20px;">
                    <strong>${finalResponses.length}</strong> r√©sidents identifi√©s
                    <br><small>(Affichage de toutes les r√©ponses pour debug)</small>
                </p>
                <div style="overflow-x: auto; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead style="background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white;">
                            <tr>
                                <th style="padding: 12px 8px; text-align: left; font-weight: 600;">Nom</th>
                                <th style="padding: 12px 8px; text-align: left; font-weight: 600;">Pr√©nom</th>
                                <th style="padding: 12px 8px; text-align: left; font-weight: 600;">Commune</th>
                                <th style="padding: 12px 8px; text-align: left; font-weight: 600;">Contact</th>
                                <th style="padding: 12px 8px; text-align: left; font-weight: 600;">D√©marches ‚Üí R√©sultat</th>
                                <th style="padding: 12px 8px; text-align: left; font-weight: 600;">Collectif</th>
                                <th style="padding: 12px 8px; text-align: left; font-weight: 600;">Nuisances</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            if (finalResponses.length === 0) {
                tableHTML += `
                    <tr>
                        <td colspan="7" style="padding: 20px; text-align: center; color: #666; font-style: italic;">
                            Aucune donn√©e stock√©e pour le moment.
                            <br><small>Essayez de remplir le questionnaire √† nouveau.</small>
                        </td>
                    </tr>
                `;
            } else {
                finalResponses.forEach((response, index) => {
                    const bgColor = index % 2 === 0 ? '#f9f9f9' : 'white';
                    
                    // Traduire les d√©marches
                    const demarchesText = response.demarches && response.demarches.length > 0 ? 
                        response.demarches.map(d => {
                            switch(d) {
                                case 'police': return 'Forces de l\'ordre';
                                case 'mairie': return 'Mairie';
                                case 'dialogue': return 'Dialogue auteurs';
                                case 'aucune': return 'Aucune d√©marche';
                                default: return d;
                            }
                        }).join(' + ') : 'Non renseign√©';
                    
                    // Traduire les suites
                    const suitesText = response.suites && response.suites.length > 0 ?
                        response.suites.map(s => {
                            switch(s) {
                                case 'aucune_suite': return 'Aucune am√©lioration';
                                case 'ponctuelle': return 'Intervention ponctuelle';
                                case 'sans_reponse': return 'Sans r√©ponse';
                                case 'pas_competence': return 'Pas de comp√©tence';
                                case 'amelioration': return 'Am√©lioration durable';
                                case 'autre_suite': return 'Autre r√©sultat';
                                default: return s;
                            }
                        }).join(', ') : 'Non renseign√©';
                    
                    // Combiner d√©marches et suites
                    const demarchesResultat = `${demarchesText} ‚Üí ${suitesText}`;
                    
                    // Traduire les nuisances
                    const nuisancesText = response.nuisances && response.nuisances.length > 0 ?
                        response.nuisances.map(n => {
                            switch(n) {
                                case 'motos': return 'Motos';
                                case 'musique': return 'Musique';
                                case 'rassemblements': return 'Rassemblements';
                                case 'autres': return 'Autres';
                                default: return n;
                            }
                        }).join(', ') : 'Non renseign√©';
                    
                    tableHTML += `
                        <tr style="background: ${bgColor};">
                            <td style="padding: 10px 8px; border-bottom: 1px solid #e0e0e0; font-weight: 600;">${response.nom || 'N/A'}</td>
                            <td style="padding: 10px 8px; border-bottom: 1px solid #e0e0e0; font-weight: 600;">${response.prenom || 'N/A'}</td>
                            <td style="padding: 10px 8px; border-bottom: 1px solid #e0e0e0; color: #1976d2;">${response.commune || 'N/A'}</td>
                            <td style="padding: 10px 8px; border-bottom: 1px solid #e0e0e0; font-size: 0.9em;">
                                ${response.telephone || 'Non renseign√©'}<br>
                                <small style="color: #666;">${response.contact || ''}</small>
                            </td>
                            <td style="padding: 10px 8px; border-bottom: 1px solid #e0e0e0; font-size: 0.9em;">${demarchesResultat}</td>
                            <td style="padding: 10px 8px; border-bottom: 1px solid #e0e0e0;">${response.collectif || 'N/A'}</td>
                            <td style="padding: 10px 8px; border-bottom: 1px solid #e0e0e0; font-size: 0.9em;">${nuisancesText}</td>
                        </tr>
                    `;
                });
            }
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
                <div style="text-align: center; margin-top: 20px; padding: 15px; background: #e8f5e8; border-radius: 10px;">
                    <p style="color: #2e7d32; margin: 0;"><strong>Document confidentiel</strong> - Usage exclusif pour l'action collective citoyenne</p>
                </div>
            `;
            
            document.getElementById('resultTable').innerHTML = tableHTML;
            document.getElementById('resultTable').style.display = 'block';
            document.getElementById('resultTable').scrollIntoView({ behavior: 'smooth' });
        }

        // Animation d'entr√©e
        document.addEventListener('DOMContentLoaded', function() {
            const questionBlocks = document.querySelectorAll('.question-block');
            questionBlocks.forEach((block, index) => {
                setTimeout(() => {
                    block.style.opacity = '0';
                    block.style.transform = 'translateY(20px)';
                    block.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        block.style.opacity = '1';
                        block.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 100);
            });
        });
    </script>
</body>
</html>